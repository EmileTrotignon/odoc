<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: odoc_link.ml (odoc.source.src.odoc)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="../../../index.html">odoc</a> &#x00BB; <a href="../../index.html">source</a> &#x00BB; <a href="../index.html">src</a> &#x00BB; <a href="index.html">odoc</a> &#x00BB; odoc_link.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>odoc_link.ml</span></code></h1></header><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
</code><code class="source_code"><span><span class="OPEN">open</span> <span class="UIDENT">Or_error</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-link_page"><span class="LIDENT">link_page</span></span> <span class="TILDE">~</span><span id="local_resolver_1"><span class="LIDENT">resolver</span></span> <span class="TILDE">~</span><span id="local_filename_2"><span class="LIDENT">filename</span></span> <span id="local_page_3"><span class="LIDENT">page</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_4"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Resolver</span><span class="DOT">.</span><span class="LIDENT">build_env_for_page</span> <a href="#local_resolver_1"><span class="LIDENT">resolver</span></a> <a href="#local_page_3"><span class="LIDENT">page</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">Odoc_xref2</span><span class="DOT">.</span><span class="UIDENT">Link</span><span class="DOT">.</span><span class="LIDENT">resolve_page</span> <span class="TILDE">~</span><a href="#local_filename_2"><span class="LIDENT">filename</span></a> <a href="#local_env_4"><span class="LIDENT">env</span></a> <a href="#local_page_3"><span class="LIDENT">page</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-link_unit"><span class="LIDENT">link_unit</span></span> <span class="TILDE">~</span><span id="local_resolver_5"><span class="LIDENT">resolver</span></span> <span class="TILDE">~</span><span id="local_filename_6"><span class="LIDENT">filename</span></span> <span id="local_m_7"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="OPEN">open</span> <span class="UIDENT">Odoc_model</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="OPEN">open</span> <span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_m_8"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">Root</span><span class="DOT">.</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">hidden</span> <a href="#local_m_7"><span class="LIDENT">m</span></a><span class="DOT">.</span><span class="LIDENT">root</span><span class="DOT">.</span><span class="LIDENT">file</span> <span class="THEN">then</span><span class="EOL">
</span>      <span class="LBRACE">{</span><span class="EOL">
</span>        <a href="#local_m_7"><span class="LIDENT">m</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="LIDENT">content</span> <span class="EQUAL">=</span> <span class="UIDENT">Module</span> <span class="LBRACE">{</span> <span class="LIDENT">items</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="SEMI">;</span> <span class="LIDENT">compiled</span> <span class="EQUAL">=</span> <span class="FALSE">false</span><span class="SEMI">;</span> <span class="LIDENT">doc</span> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="RBRACE">}</span><span class="SEMI">;</span><span class="EOL">
</span>        <span class="LIDENT">expansion</span> <span class="EQUAL">=</span> <span class="UIDENT">None</span><span class="SEMI">;</span><span class="EOL">
</span>      <span class="RBRACE">}</span><span class="EOL">
</span>    <span class="ELSE">else</span> <a href="#local_m_7"><span class="LIDENT">m</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_9"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Resolver</span><span class="DOT">.</span><span class="LIDENT">build_link_env_for_unit</span> <a href="#local_resolver_5"><span class="LIDENT">resolver</span></a> <a href="#local_m_8"><span class="LIDENT">m</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">Odoc_xref2</span><span class="DOT">.</span><span class="UIDENT">Link</span><span class="DOT">.</span><span class="LIDENT">link</span> <span class="TILDE">~</span><a href="#local_filename_6"><span class="LIDENT">filename</span></a> <a href="#local_env_9"><span class="LIDENT">env</span></a> <a href="#local_m_8"><span class="LIDENT">m</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** [~input_warnings] are the warnings stored in the input file *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-handle_warnings"><span class="LIDENT">handle_warnings</span></span> <span class="TILDE">~</span><span id="local_input_warnings_10"><span class="LIDENT">input_warnings</span></span> <span class="TILDE">~</span><span id="local_warnings_options_11"><span class="LIDENT">warnings_options</span></span> <span id="local_ww_12"><span class="LIDENT">ww</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_warnings_13"><span class="LIDENT">warnings</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">unpack_warnings</span> <a href="#local_ww_12"><span class="LIDENT">ww</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">handle_warnings</span> <span class="TILDE">~</span><a href="#local_warnings_options_11"><span class="LIDENT">warnings_options</span></a> <a href="#local_ww_12"><span class="LIDENT">ww</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_res_14"><span class="LIDENT">res</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><a href="#local_res_14"><span class="LIDENT">res</span></a><span class="COMMA">,</span> <a href="#local_input_warnings_10"><span class="LIDENT">input_warnings</span></a> <span class="INFIXOP1">@</span> <a href="#local_warnings_13"><span class="LIDENT">warnings</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Read the input file and write to the output file.
    Also return the resulting tree. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-from_odoc"><span class="LIDENT">from_odoc</span></span> <span class="TILDE">~</span><span id="local_resolver_15"><span class="LIDENT">resolver</span></span> <span class="TILDE">~</span><span id="local_warnings_options_16"><span class="LIDENT">warnings_options</span></span> <span id="local_input_17"><span class="LIDENT">input</span></span> <span id="local_output_18"><span class="LIDENT">output</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_filename_19"><span class="LIDENT">filename</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_input_17"><span class="LIDENT">input</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">load</span> <a href="#local_input_17"><span class="LIDENT">input</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_unit_20"><span class="LIDENT">unit</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_input_warnings_21"><span class="LIDENT">input_warnings</span></span> <span class="EQUAL">=</span> <a href="#local_unit_20"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">warnings</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_unit_20"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="LIDENT">content</span> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Source_tree_content</span> <span id="local_st_22"><span class="LIDENT">st</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">save_source_tree</span> <a href="#local_output_18"><span class="LIDENT">output</span></a> <span class="LABEL">~warnings:</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span> <a href="#local_st_22"><span class="LIDENT">st</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Source_tree</span> <a href="#local_st_22"><span class="LIDENT">st</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Page_content</span> <span id="local_page_23"><span class="LIDENT">page</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="#val-link_page"><span class="LIDENT">link_page</span></a> <span class="TILDE">~</span><a href="#local_resolver_15"><span class="LIDENT">resolver</span></a> <span class="TILDE">~</span><a href="#local_filename_19"><span class="LIDENT">filename</span></a> <a href="#local_page_23"><span class="LIDENT">page</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="#val-handle_warnings"><span class="LIDENT">handle_warnings</span></a> <span class="TILDE">~</span><a href="#local_input_warnings_21"><span class="LIDENT">input_warnings</span></a> <span class="TILDE">~</span><a href="#local_warnings_options_16"><span class="LIDENT">warnings_options</span></a><span class="EOL">
</span>      <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_page_24"><span class="LIDENT">page</span></span><span class="COMMA">,</span> <span id="local_warnings_25"><span class="LIDENT">warnings</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">save_page</span> <a href="#local_output_18"><span class="LIDENT">output</span></a> <span class="TILDE">~</span><a href="#local_warnings_25"><span class="LIDENT">warnings</span></a> <a href="#local_page_24"><span class="LIDENT">page</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Page</span> <a href="#local_page_24"><span class="LIDENT">page</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Unit_content</span> <span id="local_m_26"><span class="LIDENT">m</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="#val-link_unit"><span class="LIDENT">link_unit</span></a> <span class="TILDE">~</span><a href="#local_resolver_15"><span class="LIDENT">resolver</span></a> <span class="TILDE">~</span><a href="#local_filename_19"><span class="LIDENT">filename</span></a> <a href="#local_m_26"><span class="LIDENT">m</span></a><span class="EOL">
</span>      <span class="INFIXOP0">|&gt;</span> <a href="#val-handle_warnings"><span class="LIDENT">handle_warnings</span></a> <span class="TILDE">~</span><a href="#local_input_warnings_21"><span class="LIDENT">input_warnings</span></a> <span class="TILDE">~</span><a href="#local_warnings_options_16"><span class="LIDENT">warnings_options</span></a><span class="EOL">
</span>      <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_m_27"><span class="LIDENT">m</span></span><span class="COMMA">,</span> <span id="local_warnings_28"><span class="LIDENT">warnings</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="COMMENT">(* Remove the shape here so that we only depend upon odoc types
         rather than odoc and ocaml types. This means we don't break
         being able save an odocl file with odoc x.y compiled with one
         version of the compiler and load it in odoc x.y compiled with
         a different version of the compiler, provided the compiler
         itself doesn't break cross-version marshalling! This ability
         is currently being used by voodoo. *)</span><span class="EOL">
</span>      <span class="LET">let</span> <span id="local_m_29"><span class="LIDENT">m</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>        <span class="LET">let</span> <span class="OPEN">open</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span> <span class="IN">in</span><span class="EOL">
</span>        <span class="LBRACE">{</span> <a href="#local_m_27"><span class="LIDENT">m</span></a> <span class="WITH">with</span> <span class="LIDENT">shape_info</span> <span class="EQUAL">=</span> <span class="UIDENT">None</span> <span class="RBRACE">}</span><span class="EOL">
</span>      <span class="IN">in</span><span class="EOL">
</span>      <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">save_unit</span> <a href="#local_output_18"><span class="LIDENT">output</span></a> <span class="TILDE">~</span><a href="#local_warnings_28"><span class="LIDENT">warnings</span></a> <a href="#local_m_29"><span class="LIDENT">m</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Module</span> <a href="#local_m_29"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="EOL">
</span></span></code></pre></body></html>
