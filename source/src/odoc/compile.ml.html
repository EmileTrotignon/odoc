<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: compile.ml (odoc.source.src.odoc)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="../../../index.html">odoc</a> &#x00BB; <a href="../../index.html">source</a> &#x00BB; <a href="../index.html">src</a> &#x00BB; <a href="index.html">odoc</a> &#x00BB; compile.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>compile.ml</span></code></h1></header><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
<a id="L111" class="source_line" href="#L111">111</a>
<a id="L112" class="source_line" href="#L112">112</a>
<a id="L113" class="source_line" href="#L113">113</a>
<a id="L114" class="source_line" href="#L114">114</a>
<a id="L115" class="source_line" href="#L115">115</a>
<a id="L116" class="source_line" href="#L116">116</a>
<a id="L117" class="source_line" href="#L117">117</a>
<a id="L118" class="source_line" href="#L118">118</a>
<a id="L119" class="source_line" href="#L119">119</a>
<a id="L120" class="source_line" href="#L120">120</a>
<a id="L121" class="source_line" href="#L121">121</a>
<a id="L122" class="source_line" href="#L122">122</a>
<a id="L123" class="source_line" href="#L123">123</a>
<a id="L124" class="source_line" href="#L124">124</a>
<a id="L125" class="source_line" href="#L125">125</a>
<a id="L126" class="source_line" href="#L126">126</a>
<a id="L127" class="source_line" href="#L127">127</a>
<a id="L128" class="source_line" href="#L128">128</a>
<a id="L129" class="source_line" href="#L129">129</a>
<a id="L130" class="source_line" href="#L130">130</a>
<a id="L131" class="source_line" href="#L131">131</a>
<a id="L132" class="source_line" href="#L132">132</a>
<a id="L133" class="source_line" href="#L133">133</a>
<a id="L134" class="source_line" href="#L134">134</a>
<a id="L135" class="source_line" href="#L135">135</a>
<a id="L136" class="source_line" href="#L136">136</a>
<a id="L137" class="source_line" href="#L137">137</a>
<a id="L138" class="source_line" href="#L138">138</a>
<a id="L139" class="source_line" href="#L139">139</a>
<a id="L140" class="source_line" href="#L140">140</a>
<a id="L141" class="source_line" href="#L141">141</a>
<a id="L142" class="source_line" href="#L142">142</a>
<a id="L143" class="source_line" href="#L143">143</a>
<a id="L144" class="source_line" href="#L144">144</a>
<a id="L145" class="source_line" href="#L145">145</a>
<a id="L146" class="source_line" href="#L146">146</a>
<a id="L147" class="source_line" href="#L147">147</a>
<a id="L148" class="source_line" href="#L148">148</a>
<a id="L149" class="source_line" href="#L149">149</a>
<a id="L150" class="source_line" href="#L150">150</a>
<a id="L151" class="source_line" href="#L151">151</a>
<a id="L152" class="source_line" href="#L152">152</a>
<a id="L153" class="source_line" href="#L153">153</a>
<a id="L154" class="source_line" href="#L154">154</a>
<a id="L155" class="source_line" href="#L155">155</a>
<a id="L156" class="source_line" href="#L156">156</a>
<a id="L157" class="source_line" href="#L157">157</a>
<a id="L158" class="source_line" href="#L158">158</a>
<a id="L159" class="source_line" href="#L159">159</a>
<a id="L160" class="source_line" href="#L160">160</a>
<a id="L161" class="source_line" href="#L161">161</a>
<a id="L162" class="source_line" href="#L162">162</a>
<a id="L163" class="source_line" href="#L163">163</a>
<a id="L164" class="source_line" href="#L164">164</a>
<a id="L165" class="source_line" href="#L165">165</a>
<a id="L166" class="source_line" href="#L166">166</a>
<a id="L167" class="source_line" href="#L167">167</a>
<a id="L168" class="source_line" href="#L168">168</a>
<a id="L169" class="source_line" href="#L169">169</a>
<a id="L170" class="source_line" href="#L170">170</a>
<a id="L171" class="source_line" href="#L171">171</a>
<a id="L172" class="source_line" href="#L172">172</a>
<a id="L173" class="source_line" href="#L173">173</a>
<a id="L174" class="source_line" href="#L174">174</a>
<a id="L175" class="source_line" href="#L175">175</a>
<a id="L176" class="source_line" href="#L176">176</a>
<a id="L177" class="source_line" href="#L177">177</a>
<a id="L178" class="source_line" href="#L178">178</a>
<a id="L179" class="source_line" href="#L179">179</a>
<a id="L180" class="source_line" href="#L180">180</a>
<a id="L181" class="source_line" href="#L181">181</a>
<a id="L182" class="source_line" href="#L182">182</a>
<a id="L183" class="source_line" href="#L183">183</a>
<a id="L184" class="source_line" href="#L184">184</a>
<a id="L185" class="source_line" href="#L185">185</a>
<a id="L186" class="source_line" href="#L186">186</a>
<a id="L187" class="source_line" href="#L187">187</a>
<a id="L188" class="source_line" href="#L188">188</a>
<a id="L189" class="source_line" href="#L189">189</a>
<a id="L190" class="source_line" href="#L190">190</a>
<a id="L191" class="source_line" href="#L191">191</a>
<a id="L192" class="source_line" href="#L192">192</a>
<a id="L193" class="source_line" href="#L193">193</a>
<a id="L194" class="source_line" href="#L194">194</a>
<a id="L195" class="source_line" href="#L195">195</a>
<a id="L196" class="source_line" href="#L196">196</a>
<a id="L197" class="source_line" href="#L197">197</a>
<a id="L198" class="source_line" href="#L198">198</a>
<a id="L199" class="source_line" href="#L199">199</a>
<a id="L200" class="source_line" href="#L200">200</a>
<a id="L201" class="source_line" href="#L201">201</a>
<a id="L202" class="source_line" href="#L202">202</a>
<a id="L203" class="source_line" href="#L203">203</a>
<a id="L204" class="source_line" href="#L204">204</a>
<a id="L205" class="source_line" href="#L205">205</a>
<a id="L206" class="source_line" href="#L206">206</a>
<a id="L207" class="source_line" href="#L207">207</a>
<a id="L208" class="source_line" href="#L208">208</a>
<a id="L209" class="source_line" href="#L209">209</a>
<a id="L210" class="source_line" href="#L210">210</a>
<a id="L211" class="source_line" href="#L211">211</a>
<a id="L212" class="source_line" href="#L212">212</a>
<a id="L213" class="source_line" href="#L213">213</a>
<a id="L214" class="source_line" href="#L214">214</a>
<a id="L215" class="source_line" href="#L215">215</a>
<a id="L216" class="source_line" href="#L216">216</a>
<a id="L217" class="source_line" href="#L217">217</a>
<a id="L218" class="source_line" href="#L218">218</a>
<a id="L219" class="source_line" href="#L219">219</a>
<a id="L220" class="source_line" href="#L220">220</a>
<a id="L221" class="source_line" href="#L221">221</a>
<a id="L222" class="source_line" href="#L222">222</a>
<a id="L223" class="source_line" href="#L223">223</a>
<a id="L224" class="source_line" href="#L224">224</a>
<a id="L225" class="source_line" href="#L225">225</a>
<a id="L226" class="source_line" href="#L226">226</a>
<a id="L227" class="source_line" href="#L227">227</a>
<a id="L228" class="source_line" href="#L228">228</a>
<a id="L229" class="source_line" href="#L229">229</a>
<a id="L230" class="source_line" href="#L230">230</a>
<a id="L231" class="source_line" href="#L231">231</a>
<a id="L232" class="source_line" href="#L232">232</a>
<a id="L233" class="source_line" href="#L233">233</a>
<a id="L234" class="source_line" href="#L234">234</a>
<a id="L235" class="source_line" href="#L235">235</a>
<a id="L236" class="source_line" href="#L236">236</a>
<a id="L237" class="source_line" href="#L237">237</a>
<a id="L238" class="source_line" href="#L238">238</a>
<a id="L239" class="source_line" href="#L239">239</a>
<a id="L240" class="source_line" href="#L240">240</a>
<a id="L241" class="source_line" href="#L241">241</a>
<a id="L242" class="source_line" href="#L242">242</a>
<a id="L243" class="source_line" href="#L243">243</a>
<a id="L244" class="source_line" href="#L244">244</a>
<a id="L245" class="source_line" href="#L245">245</a>
<a id="L246" class="source_line" href="#L246">246</a>
<a id="L247" class="source_line" href="#L247">247</a>
<a id="L248" class="source_line" href="#L248">248</a>
<a id="L249" class="source_line" href="#L249">249</a>
<a id="L250" class="source_line" href="#L250">250</a>
<a id="L251" class="source_line" href="#L251">251</a>
<a id="L252" class="source_line" href="#L252">252</a>
<a id="L253" class="source_line" href="#L253">253</a>
<a id="L254" class="source_line" href="#L254">254</a>
<a id="L255" class="source_line" href="#L255">255</a>
<a id="L256" class="source_line" href="#L256">256</a>
<a id="L257" class="source_line" href="#L257">257</a>
<a id="L258" class="source_line" href="#L258">258</a>
<a id="L259" class="source_line" href="#L259">259</a>
<a id="L260" class="source_line" href="#L260">260</a>
<a id="L261" class="source_line" href="#L261">261</a>
<a id="L262" class="source_line" href="#L262">262</a>
<a id="L263" class="source_line" href="#L263">263</a>
<a id="L264" class="source_line" href="#L264">264</a>
<a id="L265" class="source_line" href="#L265">265</a>
<a id="L266" class="source_line" href="#L266">266</a>
<a id="L267" class="source_line" href="#L267">267</a>
<a id="L268" class="source_line" href="#L268">268</a>
<a id="L269" class="source_line" href="#L269">269</a>
<a id="L270" class="source_line" href="#L270">270</a>
<a id="L271" class="source_line" href="#L271">271</a>
<a id="L272" class="source_line" href="#L272">272</a>
<a id="L273" class="source_line" href="#L273">273</a>
<a id="L274" class="source_line" href="#L274">274</a>
<a id="L275" class="source_line" href="#L275">275</a>
<a id="L276" class="source_line" href="#L276">276</a>
<a id="L277" class="source_line" href="#L277">277</a>
<a id="L278" class="source_line" href="#L278">278</a>
<a id="L279" class="source_line" href="#L279">279</a>
<a id="L280" class="source_line" href="#L280">280</a>
<a id="L281" class="source_line" href="#L281">281</a>
<a id="L282" class="source_line" href="#L282">282</a>
<a id="L283" class="source_line" href="#L283">283</a>
<a id="L284" class="source_line" href="#L284">284</a>
<a id="L285" class="source_line" href="#L285">285</a>
<a id="L286" class="source_line" href="#L286">286</a>
<a id="L287" class="source_line" href="#L287">287</a>
<a id="L288" class="source_line" href="#L288">288</a>
<a id="L289" class="source_line" href="#L289">289</a>
<a id="L290" class="source_line" href="#L290">290</a>
<a id="L291" class="source_line" href="#L291">291</a>
<a id="L292" class="source_line" href="#L292">292</a>
<a id="L293" class="source_line" href="#L293">293</a>
<a id="L294" class="source_line" href="#L294">294</a>
<a id="L295" class="source_line" href="#L295">295</a>
<a id="L296" class="source_line" href="#L296">296</a>
<a id="L297" class="source_line" href="#L297">297</a>
<a id="L298" class="source_line" href="#L298">298</a>
<a id="L299" class="source_line" href="#L299">299</a>
<a id="L300" class="source_line" href="#L300">300</a>
<a id="L301" class="source_line" href="#L301">301</a>
<a id="L302" class="source_line" href="#L302">302</a>
<a id="L303" class="source_line" href="#L303">303</a>
<a id="L304" class="source_line" href="#L304">304</a>
<a id="L305" class="source_line" href="#L305">305</a>
</code><code class="source_code"><span><span class="OPEN">open</span> <span class="UIDENT">Astring</span><span class="EOL">
</span><span class="OPEN">open</span> <span class="UIDENT">Odoc_model</span><span class="EOL">
</span><span class="OPEN">open</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Names</span><span class="EOL">
</span><span class="OPEN">open</span> <span class="UIDENT">Or_error</span><span class="EOL">
</span><span class="EOL">
</span><span class="COMMENT">(*
 * Copyright (c) 2014 Leo White &lt;leo@lpw25.net&gt;
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *)</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-parent_spec"><span class="TYPE">type</span> <span class="LIDENT">parent_spec</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span id="type-parent_spec.constructor-Explicit"><span class="BAR">|</span> <span class="UIDENT">Explicit</span> <span class="OF">of</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">ContainerPage</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Page</span><span class="DOT">.</span><span class="LIDENT">child</span> <span class="LIDENT">list</span></span><span class="EOL">
</span>  <span id="type-parent_spec.constructor-Package"><span class="BAR">|</span> <span class="UIDENT">Package</span> <span class="OF">of</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">ContainerPage</span><span class="DOT">.</span><span class="LIDENT">t</span></span><span class="EOL">
</span>  <span id="type-parent_spec.constructor-Noparent"><span class="BAR">|</span> <span class="UIDENT">Noparent</span></span></span><span class="EOL">
</span><span class="EOL">
</span><span id="type-parent_cli_spec"><span class="TYPE">type</span> <span class="LIDENT">parent_cli_spec</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span id="type-parent_cli_spec.constructor-CliParent"><span class="BAR">|</span> <span class="UIDENT">CliParent</span> <span class="OF">of</span> <span class="LIDENT">string</span></span><span class="EOL">
</span>  <span id="type-parent_cli_spec.constructor-CliPackage"><span class="BAR">|</span> <span class="UIDENT">CliPackage</span> <span class="OF">of</span> <span class="LIDENT">string</span></span><span class="EOL">
</span>  <span id="type-parent_cli_spec.constructor-CliNoparent"><span class="BAR">|</span> <span class="UIDENT">CliNoparent</span></span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-check_is_none"><span class="LIDENT">check_is_none</span></span> <span id="local_msg_1"><span class="LIDENT">msg</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <a href="#local_msg_1"><span class="LIDENT">msg</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-check_is_empty"><span class="LIDENT">check_is_empty</span></span> <span id="local_msg_2"><span class="LIDENT">msg</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="COLONCOLON">::</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <a href="#local_msg_2"><span class="LIDENT">msg</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Used to disambiguate child references. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-is_module_name"><span class="LIDENT">is_module_name</span></span> <span id="local_n_3"><span class="LIDENT">n</span></span> <span class="EQUAL">=</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_n_3"><span class="LIDENT">n</span></a> <span class="GREATER">&gt;</span> <span class="INT">0</span> <span class="AMPERAMPER">&amp;&amp;</span> <span class="UIDENT">Char</span><span class="DOT">.</span><span class="UIDENT">Ascii</span><span class="DOT">.</span><span class="LIDENT">is_upper</span> <a href="#local_n_3"><span class="LIDENT">n</span></a><span class="DOT">.</span><span class="LBRACKET">[</span><span class="INT">0</span><span class="RBRACKET">]</span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Accepted child references:

    - [asset-foo] child is an arbitrary asset
    - [module-Foo] child is a module.
    - [module-foo], [Foo] child is a module, for backward compatibility.
    - [page-foo] child is a container or leaf page.
    - [src-foo] child is a source tree

  Parses [...-&quot;foo&quot;] as [...-foo] for backward compatibility. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-parse_parent_child_reference"><span class="LIDENT">parse_parent_child_reference</span></span> <span id="local_s_4"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_unquote_5"><span class="LIDENT">unquote</span></span> <span id="local_s_6"><span class="LIDENT">s</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_len_7"><span class="LIDENT">len</span></span> <span class="EQUAL">=</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_s_6"><span class="LIDENT">s</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="IF">if</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">head</span> <a href="#local_s_6"><span class="LIDENT">s</span></a> <span class="EQUAL">=</span> <span class="UIDENT">Some</span> <span class="CHAR">'&quot;'</span> <span class="AMPERAMPER">&amp;&amp;</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">head</span> <span class="LABEL">~rev:</span><span class="TRUE">true</span> <a href="#local_s_6"><span class="LIDENT">s</span></a> <span class="EQUAL">=</span> <span class="UIDENT">Some</span> <span class="CHAR">'&quot;'</span> <span class="AMPERAMPER">&amp;&amp;</span> <a href="#local_len_7"><span class="LIDENT">len</span></a> <span class="GREATER">&gt;</span> <span class="INT">1</span><span class="EOL">
</span>    <span class="THEN">then</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">with_range</span> <span class="LABEL">~first:</span><span class="INT">1</span> <span class="LABEL">~len:</span><span class="LPAREN">(</span><a href="#local_len_7"><span class="LIDENT">len</span></a> <span class="MINUS">-</span> <span class="INT">2</span><span class="RPAREN">)</span> <a href="#local_s_6"><span class="LIDENT">s</span></a><span class="EOL">
</span>    <span class="ELSE">else</span> <a href="#local_s_6"><span class="LIDENT">s</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">cut</span> <span class="LABEL">~sep:</span><span class="STRING">&quot;-&quot;</span> <a href="#local_s_4"><span class="LIDENT">s</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="STRING">&quot;page&quot;</span><span class="COMMA">,</span> <span id="local_n_8"><span class="LIDENT">n</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Page</span><span class="DOT">.</span><span class="UIDENT">Page_child</span> <span class="LPAREN">(</span><a href="#local_unquote_5"><span class="LIDENT">unquote</span></a> <a href="#local_n_8"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="STRING">&quot;src&quot;</span><span class="COMMA">,</span> <span id="local_n_9"><span class="LIDENT">n</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Source_tree_child</span> <span class="LPAREN">(</span><a href="#local_unquote_5"><span class="LIDENT">unquote</span></a> <a href="#local_n_9"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="STRING">&quot;asset&quot;</span><span class="COMMA">,</span> <span id="local_n_10"><span class="LIDENT">n</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Asset_child</span> <span class="LPAREN">(</span><a href="#local_unquote_5"><span class="LIDENT">unquote</span></a> <a href="#local_n_10"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="STRING">&quot;module&quot;</span><span class="COMMA">,</span> <span id="local_n_11"><span class="LIDENT">n</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Module_child</span> <span class="LPAREN">(</span><a href="#local_unquote_5"><span class="LIDENT">unquote</span></a> <span class="LPAREN">(</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="UIDENT">Ascii</span><span class="DOT">.</span><span class="LIDENT">capitalize</span> <a href="#local_n_11"><span class="LIDENT">n</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_k_12"><span class="LIDENT">k</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="LPAREN">(</span><span class="STRING">&quot;Unrecognized kind: &quot;</span> <span class="INFIXOP1">^</span> <a href="#local_k_12"><span class="LIDENT">k</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="IF">if</span> <a href="#val-is_module_name"><span class="LIDENT">is_module_name</span></a> <a href="#local_s_4"><span class="LIDENT">s</span></a> <span class="THEN">then</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Module_child</span> <a href="#local_s_4"><span class="LIDENT">s</span></a><span class="RPAREN">)</span> <span class="ELSE">else</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Page_child</span> <a href="#local_s_4"><span class="LIDENT">s</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-resolve_parent_page"><span class="LIDENT">resolve_parent_page</span></span> <span id="local_resolver_13"><span class="LIDENT">resolver</span></span> <span id="local_f_14"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_find_parent_15"><span class="LIDENT">find_parent</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Page</span><span class="DOT">.</span><span class="UIDENT">Page_child</span> <span id="local_p_16"><span class="LIDENT">p</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="MATCH">match</span> <span class="UIDENT">Resolver</span><span class="DOT">.</span><span class="LIDENT">lookup_page</span> <a href="#local_resolver_13"><span class="LIDENT">resolver</span></a> <a href="#local_p_16"><span class="LIDENT">p</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_r_17"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_r_17"><span class="LIDENT">r</span></a><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Couldn't find specified parent page&quot;</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Source_tree_child</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Module_child</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Asset_child</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Expecting page as parent&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_extract_parent_18"><span class="LIDENT">extract_parent</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="LBRACE">{</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="LIDENT">iv</span> <span class="EQUAL">=</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Page</span> <span class="UNDERSCORE">_</span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_container_19"><span class="LIDENT">container</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <a href="#local_container_19"><span class="LIDENT">container</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Specified parent is not a parent of this file&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <a href="#val-parse_parent_child_reference"><span class="LIDENT">parse_parent_child_reference</span></a> <a href="#local_f_14"><span class="LIDENT">f</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_r_20"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <a href="#local_find_parent_15"><span class="LIDENT">find_parent</span></a> <a href="#local_r_20"><span class="LIDENT">r</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_page_21"><span class="LIDENT">page</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <a href="#local_extract_parent_18"><span class="LIDENT">extract_parent</span></a> <a href="#local_page_21"><span class="LIDENT">page</span></a><span class="DOT">.</span><span class="LIDENT">name</span> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_parent_22"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><a href="#local_parent_22"><span class="LIDENT">parent</span></a><span class="COMMA">,</span> <a href="#local_page_21"><span class="LIDENT">page</span></a><span class="DOT">.</span><span class="LIDENT">children</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-parent"><span class="LIDENT">parent</span></span> <span id="local_resolver_23"><span class="LIDENT">resolver</span></span> <span id="local_parent_cli_spec_24"><span class="LIDENT">parent_cli_spec</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_parent_cli_spec_24"><span class="LIDENT">parent_cli_spec</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">CliParent</span> <span id="local_f_25"><span class="LIDENT">f</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <a href="#val-resolve_parent_page"><span class="LIDENT">resolve_parent_page</span></a> <a href="#local_resolver_23"><span class="LIDENT">resolver</span></a> <a href="#local_f_25"><span class="LIDENT">f</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span id="local_parent_26"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_children_27"><span class="LIDENT">children</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Explicit</span> <span class="LPAREN">(</span><a href="#local_parent_26"><span class="LIDENT">parent</span></a><span class="COMMA">,</span> <a href="#local_children_27"><span class="LIDENT">children</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">CliPackage</span> <span id="local_package_28"><span class="LIDENT">package</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Package</span> <span class="LPAREN">(</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">page</span> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <span class="UIDENT">PageName</span><span class="DOT">.</span><span class="LIDENT">make_std</span> <a href="#local_package_28"><span class="LIDENT">package</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">CliNoparent</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="UIDENT">Noparent</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-resolve_imports"><span class="LIDENT">resolve_imports</span></span> <span id="local_resolver_29"><span class="LIDENT">resolver</span></span> <span id="local_imports_30"><span class="LIDENT">imports</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">map</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="FUNCTION">function</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span><span class="DOT">.</span><span class="UIDENT">Import</span><span class="DOT">.</span><span class="UIDENT">Resolved</span> <span class="UNDERSCORE">_</span> <span class="AS">as</span> <span id="local_resolved_31"><span class="LIDENT">resolved</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_resolved_31"><span class="LIDENT">resolved</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Unresolved</span> <span class="LPAREN">(</span><span id="local_name_33"><span class="LIDENT">name</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="AS">as</span> <span id="local_unresolved_32"><span class="LIDENT">unresolved</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="MATCH">match</span> <span class="UIDENT">Resolver</span><span class="DOT">.</span><span class="LIDENT">resolve_import</span> <a href="#local_resolver_29"><span class="LIDENT">resolver</span></a> <a href="#local_name_33"><span class="LIDENT">name</span></a> <span class="WITH">with</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_root_34"><span class="LIDENT">root</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Resolved</span> <span class="LPAREN">(</span><a href="#local_root_34"><span class="LIDENT">root</span></a><span class="COMMA">,</span> <span class="UIDENT">Names</span><span class="DOT">.</span><span class="UIDENT">ModuleName</span><span class="DOT">.</span><span class="LIDENT">make_std</span> <a href="#local_name_33"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>          <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_unresolved_32"><span class="LIDENT">unresolved</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <a href="#local_imports_30"><span class="LIDENT">imports</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Raises warnings and errors. *)</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-resolve_and_substitute"><span class="LIDENT">resolve_and_substitute</span></span> <span class="TILDE">~</span><span id="local_resolver_35"><span class="LIDENT">resolver</span></span> <span class="TILDE">~</span><span id="local_make_root_36"><span class="LIDENT">make_root</span></span> <span class="TILDE">~</span><span id="local_source_id_opt_37"><span class="LIDENT">source_id_opt</span></span> <span class="TILDE">~</span><span id="local_cmt_filename_opt_38"><span class="LIDENT">cmt_filename_opt</span></span><span class="EOL">
</span>    <span class="TILDE">~</span><span id="local_hidden_39"><span class="LIDENT">hidden</span></span> <span class="LPAREN">(</span><span id="local_parent_40"><span class="LIDENT">parent</span></span> <span class="COLON">:</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">ContainerPage</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span><span class="RPAREN">)</span> <span id="local_input_file_41"><span class="LIDENT">input_file</span></span><span class="EOL">
</span>    <span id="local_input_type_42"><span class="LIDENT">input_type</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_filename_43"><span class="LIDENT">filename</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_input_file_41"><span class="LIDENT">input_file</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_unit_44"><span class="LIDENT">unit</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_input_type_42"><span class="LIDENT">input_type</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Cmti</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Odoc_loader</span><span class="DOT">.</span><span class="LIDENT">read_cmti</span> <span class="TILDE">~</span><a href="#local_make_root_36"><span class="LIDENT">make_root</span></a> <span class="TILDE">~</span><a href="#local_parent_40"><span class="LIDENT">parent</span></a> <span class="TILDE">~</span><a href="#local_filename_43"><span class="LIDENT">filename</span></a> <span class="TILDE">~</span><a href="#local_source_id_opt_37"><span class="LIDENT">source_id_opt</span></a><span class="EOL">
</span>          <span class="TILDE">~</span><a href="#local_cmt_filename_opt_38"><span class="LIDENT">cmt_filename_opt</span></a><span class="EOL">
</span>        <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">raise_errors_and_warnings</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Cmt</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Odoc_loader</span><span class="DOT">.</span><span class="LIDENT">read_cmt</span> <span class="TILDE">~</span><a href="#local_make_root_36"><span class="LIDENT">make_root</span></a> <span class="TILDE">~</span><a href="#local_parent_40"><span class="LIDENT">parent</span></a> <span class="TILDE">~</span><a href="#local_filename_43"><span class="LIDENT">filename</span></a> <span class="TILDE">~</span><a href="#local_source_id_opt_37"><span class="LIDENT">source_id_opt</span></a><span class="EOL">
</span>        <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">raise_errors_and_warnings</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Cmi</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Odoc_loader</span><span class="DOT">.</span><span class="LIDENT">read_cmi</span> <span class="TILDE">~</span><a href="#local_make_root_36"><span class="LIDENT">make_root</span></a> <span class="TILDE">~</span><a href="#local_parent_40"><span class="LIDENT">parent</span></a> <span class="TILDE">~</span><a href="#local_filename_43"><span class="LIDENT">filename</span></a><span class="EOL">
</span>        <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">raise_errors_and_warnings</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_unit_45"><span class="LIDENT">unit</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <a href="#local_unit_44"><span class="LIDENT">unit</span></a> <span class="WITH">with</span> <span class="LIDENT">hidden</span> <span class="EQUAL">=</span> <a href="#local_hidden_39"><span class="LIDENT">hidden</span></a> <span class="BARBAR">||</span> <a href="#local_unit_44"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="LIDENT">hidden</span> <span class="RBRACE">}</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <span class="LIDENT">not</span> <a href="#local_unit_45"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span><span class="DOT">.</span><span class="LIDENT">interface</span> <span class="THEN">then</span><span class="EOL">
</span>    <span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">eprintf</span> <span class="STRING">&quot;WARNING: not processing the \&quot;interface\&quot; file.%s\n%!&quot;</span><span class="EOL">
</span>      <span class="LPAREN">(</span><span class="IF">if</span> <span class="LIDENT">not</span> <span class="LPAREN">(</span><span class="UIDENT">Filename</span><span class="DOT">.</span><span class="LIDENT">check_suffix</span> <a href="#local_filename_43"><span class="LIDENT">filename</span></a> <span class="STRING">&quot;cmt&quot;</span><span class="RPAREN">)</span> <span class="THEN">then</span> <span class="STRING">&quot;&quot;</span> <span class="COMMENT">(* ? *)</span><span class="EOL">
</span>       <span class="ELSE">else</span><span class="EOL">
</span>         <span class="UIDENT">Printf</span><span class="DOT">.</span><span class="LIDENT">sprintf</span> <span class="STRING">&quot; Using %S while you should use the .cmti file&quot;</span> <a href="#local_filename_43"><span class="LIDENT">filename</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <span class="COMMENT">(* Resolve imports, used by the [link-deps] command. *)</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_unit_46"><span class="LIDENT">unit</span></span> <span class="EQUAL">=</span> <span class="LBRACE">{</span> <a href="#local_unit_45"><span class="LIDENT">unit</span></a> <span class="WITH">with</span> <span class="LIDENT">imports</span> <span class="EQUAL">=</span> <a href="#val-resolve_imports"><span class="LIDENT">resolve_imports</span></a> <a href="#local_resolver_35"><span class="LIDENT">resolver</span></a> <a href="#local_unit_45"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="LIDENT">imports</span> <span class="RBRACE">}</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_env_47"><span class="LIDENT">env</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Resolver</span><span class="DOT">.</span><span class="LIDENT">build_compile_env_for_unit</span> <a href="#local_resolver_35"><span class="LIDENT">resolver</span></a> <a href="#local_unit_46"><span class="LIDENT">unit</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_compiled_48"><span class="LIDENT">compiled</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Odoc_xref2</span><span class="DOT">.</span><span class="UIDENT">Compile</span><span class="DOT">.</span><span class="LIDENT">compile</span> <span class="TILDE">~</span><a href="#local_filename_43"><span class="LIDENT">filename</span></a> <a href="#local_env_47"><span class="LIDENT">env</span></a> <a href="#local_unit_46"><span class="LIDENT">unit</span></a> <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">raise_warnings</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="COMMENT">(* [expand unit] fetches [unit] from [env] to get the expansion of local, previously
     defined, elements. We'd rather it got back the resolved bit so we rebuild an
     environment with the resolved unit.
     Note that this is bad and once rewritten expand should not fetch the unit it is
     working on. *)</span><span class="EOL">
</span>  <span class="COMMENT">(*    let expand_env = Env.build env (`Unit resolved) in*)</span><span class="EOL">
</span>  <span class="COMMENT">(*    let expanded = Odoc_xref2.Expand.expand (Env.expander expand_env) resolved in *)</span><span class="EOL">
</span>  <a href="#local_compiled_48"><span class="LIDENT">compiled</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-root_of_compilation_unit"><span class="LIDENT">root_of_compilation_unit</span></span> <span class="TILDE">~</span><span id="local_parent_spec_49"><span class="LIDENT">parent_spec</span></span> <span class="TILDE">~</span><span id="local_hidden_50"><span class="LIDENT">hidden</span></span> <span class="TILDE">~</span><span id="local_output_51"><span class="LIDENT">output</span></span> <span class="TILDE">~</span><span id="local_module_name_52"><span class="LIDENT">module_name</span></span> <span class="TILDE">~</span><span id="local_digest_53"><span class="LIDENT">digest</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="OPEN">open</span> <span class="UIDENT">Root</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_filename_54"><span class="LIDENT">filename</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Filename</span><span class="DOT">.</span><span class="LIDENT">chop_extension</span> <span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LPAREN">(</span><span class="LIDENT">to_string</span> <span class="INFIXOP1">@@</span> <span class="LIDENT">basename</span> <a href="#local_output_51"><span class="LIDENT">output</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_result_55"><span class="LIDENT">result</span></span> <span id="local_parent_56"><span class="LIDENT">parent</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_file_57"><span class="LIDENT">file</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">create_unit</span> <span class="LABEL">~force_hidden:</span><a href="#local_hidden_50"><span class="LIDENT">hidden</span></a> <a href="#local_module_name_52"><span class="LIDENT">module_name</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Ok</span><span class="EOL">
</span>      <span class="LBRACE">{</span><span class="EOL">
</span>        <span class="LIDENT">id</span> <span class="EQUAL">=</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">root</span> <span class="LPAREN">(</span><a href="#local_parent_56"><span class="LIDENT">parent</span></a><span class="COMMA">,</span> <span class="UIDENT">ModuleName</span><span class="DOT">.</span><span class="LIDENT">make_std</span> <a href="#local_module_name_52"><span class="LIDENT">module_name</span></a><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_file_57"><span class="LIDENT">file</span></a><span class="SEMI">;</span><span class="EOL">
</span>        <a href="#local_digest_53"><span class="LIDENT">digest</span></a><span class="SEMI">;</span><span class="EOL">
</span>      <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_check_child_58"><span class="LIDENT">check_child</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Page</span><span class="DOT">.</span><span class="UIDENT">Module_child</span> <span id="local_n_59"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">String</span><span class="DOT">.</span><span class="UIDENT">Ascii</span><span class="DOT">.</span><span class="LPAREN">(</span><span class="LIDENT">uncapitalize</span> <a href="#local_n_59"><span class="LIDENT">n</span></a> <span class="EQUAL">=</span> <span class="LIDENT">uncapitalize</span> <a href="#local_filename_54"><span class="LIDENT">filename</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Asset_child</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Source_tree_child</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Page_child</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_parent_spec_49"><span class="LIDENT">parent_spec</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Noparent</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_result_55"><span class="LIDENT">result</span></a> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Explicit</span> <span class="LPAREN">(</span><span id="local_parent_60"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_children_61"><span class="LIDENT">children</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="IF">if</span> <span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">exists</span> <a href="#local_check_child_58"><span class="LIDENT">check_child</span></a> <a href="#local_children_61"><span class="LIDENT">children</span></a> <span class="THEN">then</span> <a href="#local_result_55"><span class="LIDENT">result</span></a> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_parent_60"><span class="LIDENT">parent</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="ELSE">else</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Specified parent is not a parent of this file&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Package</span> <span id="local_parent_62"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_result_55"><span class="LIDENT">result</span></a> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_parent_62"><span class="LIDENT">parent</span></a><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-name_of_output"><span class="LIDENT">name_of_output</span></span> <span class="TILDE">~</span><span id="local_prefix_63"><span class="LIDENT">prefix</span></span> <span id="local_output_64"><span class="LIDENT">output</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_page_dash_root_65"><span class="LIDENT">page_dash_root</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="UIDENT">Filename</span><span class="DOT">.</span><span class="LIDENT">chop_extension</span> <span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LPAREN">(</span><span class="LIDENT">to_string</span> <span class="INFIXOP1">@@</span> <span class="LIDENT">basename</span> <a href="#local_output_64"><span class="LIDENT">output</span></a><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">drop</span> <span class="LABEL">~max:</span><span class="LPAREN">(</span><span class="UIDENT">String</span><span class="DOT">.</span><span class="LIDENT">length</span> <a href="#local_prefix_63"><span class="LIDENT">prefix</span></a><span class="RPAREN">)</span> <a href="#local_page_dash_root_65"><span class="LIDENT">page_dash_root</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-page_name_of_output"><span class="LIDENT">page_name_of_output</span></span> <span class="TILDE">~</span><span id="local_is_parent_explicit_66"><span class="LIDENT">is_parent_explicit</span></span> <span id="local_output_67"><span class="LIDENT">output</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_root_name_68"><span class="LIDENT">root_name</span></span> <span class="EQUAL">=</span> <a href="#val-name_of_output"><span class="LIDENT">name_of_output</span></a> <span class="LABEL">~prefix:</span><span class="STRING">&quot;page-&quot;</span> <a href="#local_output_67"><span class="LIDENT">output</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_is_parent_explicit_66"><span class="LIDENT">is_parent_explicit</span></a> <span class="THEN">then</span><span class="EOL">
</span>     <span class="MATCH">match</span> <a href="#local_root_name_68"><span class="LIDENT">root_name</span></a> <span class="WITH">with</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="STRING">&quot;index&quot;</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <span class="UIDENT">Format</span><span class="DOT">.</span><span class="LIDENT">eprintf</span><span class="EOL">
</span>           <span class="STRING">&quot;Warning: Potential name clash - child page named 'index'\n%!&quot;</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="SEMI">;</span><span class="EOL">
</span>  <a href="#local_root_name_68"><span class="LIDENT">root_name</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-mld"><span class="LIDENT">mld</span></span> <span class="TILDE">~</span><span id="local_parent_spec_69"><span class="LIDENT">parent_spec</span></span> <span class="TILDE">~</span><span id="local_output_70"><span class="LIDENT">output</span></span> <span class="TILDE">~</span><span id="local_children_71"><span class="LIDENT">children</span></span> <span class="TILDE">~</span><span id="local_warnings_options_72"><span class="LIDENT">warnings_options</span></span> <span id="local_input_73"><span class="LIDENT">input</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">fold_left</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="FUN">fun</span> <span id="local_acc_74"><span class="LIDENT">acc</span></span> <span id="local_child_str_75"><span class="LIDENT">child_str</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="LPAREN">(</span><a href="#local_acc_74"><span class="LIDENT">acc</span></a><span class="COMMA">,</span> <a href="#val-parse_parent_child_reference"><span class="LIDENT">parse_parent_child_reference</span></a> <a href="#local_child_str_75"><span class="LIDENT">child_str</span></a><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Ok</span> <span id="local_acc_76"><span class="LIDENT">acc</span></span><span class="COMMA">,</span> <span class="UIDENT">Ok</span> <span id="local_r_77"><span class="LIDENT">r</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><a href="#local_r_77"><span class="LIDENT">r</span></a> <span class="COLONCOLON">::</span> <a href="#local_acc_76"><span class="LIDENT">acc</span></a><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Error</span> <span id="local_m_78"><span class="LIDENT">m</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <a href="#local_m_78"><span class="LIDENT">m</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span id="local_m_79"><span class="LIDENT">m</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="LPAREN">(</span><span class="STRING">&quot;Failed to parse child reference: &quot;</span> <span class="INFIXOP1">^</span> <a href="#local_m_79"><span class="LIDENT">m</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span class="UIDENT">Error</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Unknown failure parsing child reference&quot;</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="UIDENT">Ok</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span><span class="RPAREN">)</span> <a href="#local_children_71"><span class="LIDENT">children</span></a><span class="EOL">
</span>  <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_children_80"><span class="LIDENT">children</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_root_name_81"><span class="LIDENT">root_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_is_parent_explicit_82"><span class="LIDENT">is_parent_explicit</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_parent_spec_69"><span class="LIDENT">parent_spec</span></a> <span class="WITH">with</span> <span class="UIDENT">Explicit</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="TRUE">true</span> <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <a href="#val-page_name_of_output"><span class="LIDENT">page_name_of_output</span></a> <span class="TILDE">~</span><a href="#local_is_parent_explicit_82"><span class="LIDENT">is_parent_explicit</span></a> <a href="#local_output_70"><span class="LIDENT">output</span></a><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_input_s_83"><span class="LIDENT">input_s</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_input_73"><span class="LIDENT">input</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_digest_84"><span class="LIDENT">digest</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Digest</span><span class="DOT">.</span><span class="LIDENT">file</span> <a href="#local_input_s_83"><span class="LIDENT">input_s</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_page_name_85"><span class="LIDENT">page_name</span></span> <span class="EQUAL">=</span> <span class="UIDENT">PageName</span><span class="DOT">.</span><span class="LIDENT">make_std</span> <a href="#local_root_name_81"><span class="LIDENT">root_name</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_check_child_86"><span class="LIDENT">check_child</span></span> <span class="EQUAL">=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Page</span><span class="DOT">.</span><span class="UIDENT">Page_child</span> <span id="local_n_87"><span class="LIDENT">n</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_root_name_81"><span class="LIDENT">root_name</span></a> <span class="EQUAL">=</span> <a href="#local_n_87"><span class="LIDENT">n</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Asset_child</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Source_tree_child</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Module_child</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="FALSE">false</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LPAREN">(</span><span class="IF">if</span> <a href="#local_children_80"><span class="LIDENT">children</span></a> <span class="EQUAL">=</span> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="THEN">then</span><span class="EOL">
</span>     <span class="COMMENT">(* No children, this is a leaf page. *)</span><span class="EOL">
</span>     <span class="MATCH">match</span> <a href="#local_parent_spec_69"><span class="LIDENT">parent_spec</span></a> <span class="WITH">with</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UIDENT">Explicit</span> <span class="LPAREN">(</span><span id="local_p_88"><span class="LIDENT">p</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">leaf_page</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_p_88"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <a href="#local_page_name_85"><span class="LIDENT">page_name</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UIDENT">Package</span> <span id="local_parent_89"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">leaf_page</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_parent_89"><span class="LIDENT">parent</span></a><span class="COMMA">,</span> <a href="#local_page_name_85"><span class="LIDENT">page_name</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UIDENT">Noparent</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">leaf_page</span> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <a href="#local_page_name_85"><span class="LIDENT">page_name</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>   <span class="ELSE">else</span><span class="EOL">
</span>     <span class="COMMENT">(* Has children, this is a container page. *)</span><span class="EOL">
</span>     <span class="LET">let</span> <span id="local_check_90"><span class="LIDENT">check</span></span> <span id="local_parents_children_91"><span class="LIDENT">parents_children</span></span> <span id="local_v_92"><span class="LIDENT">v</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>       <span class="IF">if</span> <span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">exists</span> <a href="#local_check_child_86"><span class="LIDENT">check_child</span></a> <a href="#local_parents_children_91"><span class="LIDENT">parents_children</span></a> <span class="THEN">then</span> <span class="UIDENT">Ok</span> <a href="#local_v_92"><span class="LIDENT">v</span></a><span class="EOL">
</span>       <span class="ELSE">else</span> <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Specified parent is not a parent of this file&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>     <span class="IN">in</span><span class="EOL">
</span>     <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_parent_spec_69"><span class="LIDENT">parent_spec</span></a> <span class="WITH">with</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UIDENT">Explicit</span> <span class="LPAREN">(</span><span id="local_p_93"><span class="LIDENT">p</span></span><span class="COMMA">,</span> <span id="local_cs_94"><span class="LIDENT">cs</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <a href="#local_check_90"><span class="LIDENT">check</span></a> <a href="#local_cs_94"><span class="LIDENT">cs</span></a> <span class="INFIXOP1">@@</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">page</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_p_93"><span class="LIDENT">p</span></a><span class="COMMA">,</span> <a href="#local_page_name_85"><span class="LIDENT">page_name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UIDENT">Package</span> <span id="local_parent_95"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>         <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">page</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_parent_95"><span class="LIDENT">parent</span></a><span class="COMMA">,</span> <a href="#local_page_name_85"><span class="LIDENT">page_name</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>         <span class="COMMENT">(* This is a bit odd *)</span><span class="EOL">
</span>     <span class="BAR">|</span> <span class="UIDENT">Noparent</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">page</span> <span class="LPAREN">(</span><span class="UIDENT">None</span><span class="COMMA">,</span> <a href="#local_page_name_85"><span class="LIDENT">page_name</span></a><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>     <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_id_96"><span class="LIDENT">id</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><a href="#local_id_96"><span class="LIDENT">id</span></a> <span class="COLONGREATER">:&gt;</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Page</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_name_97"><span class="LIDENT">name</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_root_98"><span class="LIDENT">root</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_file_99"><span class="LIDENT">file</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Root</span><span class="DOT">.</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">create_page</span> <a href="#local_root_name_81"><span class="LIDENT">root_name</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LBRACE">{</span> <span class="UIDENT">Root</span><span class="DOT">.</span><span class="LIDENT">id</span> <span class="EQUAL">=</span> <span class="LPAREN">(</span><a href="#local_name_97"><span class="LIDENT">name</span></a> <span class="COLONGREATER">:&gt;</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">OdocId</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span><span class="SEMI">;</span> <a href="#local_file_99"><span class="LIDENT">file</span></a><span class="SEMI">;</span> <a href="#local_digest_84"><span class="LIDENT">digest</span></a> <span class="RBRACE">}</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_resolve_100"><span class="LIDENT">resolve</span></span> <span id="local_content_101"><span class="LIDENT">content</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_page_102"><span class="LIDENT">page</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">Page</span><span class="DOT">.</span><span class="LBRACE">{</span> <a href="#local_name_97"><span class="LIDENT">name</span></a><span class="SEMI">;</span> <a href="#local_root_98"><span class="LIDENT">root</span></a><span class="SEMI">;</span> <a href="#local_children_80"><span class="LIDENT">children</span></a><span class="SEMI">;</span> <a href="#local_content_101"><span class="LIDENT">content</span></a><span class="SEMI">;</span> <a href="#local_digest_84"><span class="LIDENT">digest</span></a><span class="SEMI">;</span> <span class="LIDENT">linked</span> <span class="EQUAL">=</span> <span class="FALSE">false</span> <span class="RBRACE">}</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">save_page</span> <a href="#local_output_70"><span class="LIDENT">output</span></a> <span class="LABEL">~warnings:</span><span class="LBRACKET">[</span><span class="RBRACKET">]</span> <a href="#local_page_102"><span class="LIDENT">page</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">read</span> <a href="#local_input_73"><span class="LIDENT">input</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_str_103"><span class="LIDENT">str</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="UIDENT">Odoc_loader</span><span class="DOT">.</span><span class="LIDENT">read_string</span> <span class="LPAREN">(</span><a href="#local_name_97"><span class="LIDENT">name</span></a> <span class="COLONGREATER">:&gt;</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">LabelParent</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span> <a href="#local_input_s_83"><span class="LIDENT">input_s</span></a> <a href="#local_str_103"><span class="LIDENT">str</span></a><span class="EOL">
</span>  <span class="INFIXOP0">|&gt;</span> <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">handle_errors_and_warnings</span> <span class="TILDE">~</span><a href="#local_warnings_options_72"><span class="LIDENT">warnings_options</span></a><span class="EOL">
</span>  <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUNCTION">function</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Stop</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_resolve_100"><span class="LIDENT">resolve</span></a> <span class="LBRACKET">[</span><span class="RBRACKET">]</span> <span class="COMMENT">(* TODO: Error? *)</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Docs</span> <span id="local_content_104"><span class="LIDENT">content</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_resolve_100"><span class="LIDENT">resolve</span></a> <a href="#local_content_104"><span class="LIDENT">content</span></a><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-handle_file_ext"><span class="LIDENT">handle_file_ext</span></span> <span id="local_ext_105"><span class="LIDENT">ext</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_ext_105"><span class="LIDENT">ext</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="STRING">&quot;.cmti&quot;</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Cmti</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="STRING">&quot;.cmt&quot;</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Cmt</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="STRING">&quot;.cmi&quot;</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Cmi</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>      <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Unknown extension, expected one of: cmti, cmt, cmi or mld.&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-compile"><span class="LIDENT">compile</span></span> <span class="TILDE">~</span><span id="local_resolver_106"><span class="LIDENT">resolver</span></span> <span class="TILDE">~</span><span id="local_parent_cli_spec_107"><span class="LIDENT">parent_cli_spec</span></span> <span class="TILDE">~</span><span id="local_hidden_108"><span class="LIDENT">hidden</span></span> <span class="TILDE">~</span><span id="local_children_109"><span class="LIDENT">children</span></span> <span class="TILDE">~</span><span id="local_output_110"><span class="LIDENT">output</span></span><span class="EOL">
</span>    <span class="TILDE">~</span><span id="local_warnings_options_111"><span class="LIDENT">warnings_options</span></span> <span class="TILDE">~</span><span id="local_source_112"><span class="LIDENT">source</span></span> <span class="TILDE">~</span><span id="local_cmt_filename_opt_113"><span class="LIDENT">cmt_filename_opt</span></span> <span id="local_input_114"><span class="LIDENT">input</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <a href="#val-parent"><span class="LIDENT">parent</span></a> <a href="#local_resolver_106"><span class="LIDENT">resolver</span></a> <a href="#local_parent_cli_spec_107"><span class="LIDENT">parent_cli_spec</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_parent_spec_115"><span class="LIDENT">parent_spec</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_ext_116"><span class="LIDENT">ext</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Fs</span><span class="DOT">.</span><span class="UIDENT">File</span><span class="DOT">.</span><span class="LIDENT">get_ext</span> <a href="#local_input_114"><span class="LIDENT">input</span></a> <span class="IN">in</span><span class="EOL">
</span>  <span class="IF">if</span> <a href="#local_ext_116"><span class="LIDENT">ext</span></a> <span class="EQUAL">=</span> <span class="STRING">&quot;.mld&quot;</span> <span class="THEN">then</span><span class="EOL">
</span>    <a href="#val-check_is_none"><span class="LIDENT">check_is_none</span></a> <span class="STRING">&quot;Not expecting source (--source-*) when compiling pages.&quot;</span><span class="EOL">
</span>      <a href="#local_source_112"><span class="LIDENT">source</span></a><span class="EOL">
</span>    <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="#val-check_is_none"><span class="LIDENT">check_is_none</span></a> <span class="STRING">&quot;Not expecting cmt filename (--cmt) when compiling pages.&quot;</span><span class="EOL">
</span>      <a href="#local_cmt_filename_opt_113"><span class="LIDENT">cmt_filename_opt</span></a><span class="EOL">
</span>    <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#val-mld"><span class="LIDENT">mld</span></a> <span class="TILDE">~</span><a href="#local_parent_spec_115"><span class="LIDENT">parent_spec</span></a> <span class="TILDE">~</span><a href="#local_output_110"><span class="LIDENT">output</span></a> <span class="TILDE">~</span><a href="#local_warnings_options_111"><span class="LIDENT">warnings_options</span></a> <span class="TILDE">~</span><a href="#local_children_109"><span class="LIDENT">children</span></a> <a href="#local_input_114"><span class="LIDENT">input</span></a><span class="EOL">
</span>  <span class="ELSE">else</span><span class="EOL">
</span>    <a href="#val-check_is_empty"><span class="LIDENT">check_is_empty</span></a> <span class="STRING">&quot;Not expecting children (--child) when compiling modules.&quot;</span><span class="EOL">
</span>      <a href="#local_children_109"><span class="LIDENT">children</span></a><span class="EOL">
</span>    <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LPAREN">(</span><span class="MATCH">match</span> <a href="#local_source_112"><span class="LIDENT">source</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_parent_117"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_118"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">load</span> <a href="#local_parent_117"><span class="LIDENT">parent</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_parent_119"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="LET">let</span> <span id="local_err_not_parent_120"><span class="LIDENT">err_not_parent</span></span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="EQUAL">=</span><span class="EOL">
</span>          <span class="UIDENT">Error</span> <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Specified source-parent is not a parent of the source.&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="IN">in</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_parent_119"><span class="LIDENT">parent</span></a><span class="DOT">.</span><span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">content</span> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Source_tree_content</span> <span id="local_page_121"><span class="LIDENT">page</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>            <span class="MATCH">match</span> <a href="#local_page_121"><span class="LIDENT">page</span></a><span class="DOT">.</span><span class="UIDENT">Lang</span><span class="DOT">.</span><span class="UIDENT">SourceTree</span><span class="DOT">.</span><span class="LIDENT">name</span> <span class="WITH">with</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="LBRACE">{</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="LIDENT">iv</span> <span class="EQUAL">=</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Page</span> <span class="UNDERSCORE">_</span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="AS">as</span> <span id="local_parent_id_122"><span class="LIDENT">parent_id</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>                <span class="LET">let</span> <span id="local_id_123"><span class="LIDENT">id</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span><span class="DOT">.</span><span class="LIDENT">source_page</span> <span class="LPAREN">(</span><a href="#local_parent_id_122"><span class="LIDENT">parent_id</span></a><span class="COMMA">,</span> <a href="#local_name_118"><span class="LIDENT">name</span></a><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>                <span class="IF">if</span> <span class="UIDENT">List</span><span class="DOT">.</span><span class="LIDENT">exists</span> <span class="LPAREN">(</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="LIDENT">equal</span> <a href="#local_id_123"><span class="LIDENT">id</span></a><span class="RPAREN">)</span> <a href="#local_page_121"><span class="LIDENT">page</span></a><span class="DOT">.</span><span class="LIDENT">source_children</span><span class="EOL">
</span>                <span class="THEN">then</span> <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="UIDENT">Some</span> <a href="#local_id_123"><span class="LIDENT">id</span></a><span class="RPAREN">)</span><span class="EOL">
</span>                <span class="ELSE">else</span> <a href="#local_err_not_parent_120"><span class="LIDENT">err_not_parent</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span>            <span class="BAR">|</span> <span class="LBRACE">{</span> <span class="LIDENT">iv</span> <span class="EQUAL">=</span> <span class="BACKQUOTE">`</span><span class="UIDENT">LeafPage</span> <span class="UNDERSCORE">_</span><span class="SEMI">;</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_err_not_parent_120"><span class="LIDENT">err_not_parent</span></a> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Unit_content</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="UIDENT">Page_content</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>            <span class="UIDENT">Error</span><span class="EOL">
</span>              <span class="LPAREN">(</span><span class="BACKQUOTE">`</span><span class="UIDENT">Msg</span> <span class="STRING">&quot;Specified source-parent should be a page but is a module.&quot;</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Ok</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_source_id_opt_124"><span class="LIDENT">source_id_opt</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <a href="#val-handle_file_ext"><span class="LIDENT">handle_file_ext</span></a> <a href="#local_ext_116"><span class="LIDENT">ext</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_input_type_125"><span class="LIDENT">input_type</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_parent_126"><span class="LIDENT">parent</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_parent_spec_115"><span class="LIDENT">parent_spec</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Noparent</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Explicit</span> <span class="LPAREN">(</span><span id="local_parent_127"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_parent_127"><span class="LIDENT">parent</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Package</span> <span id="local_parent_128"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_parent_128"><span class="LIDENT">parent</span></a><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_make_root_129"><span class="LIDENT">make_root</span></span> <span class="EQUAL">=</span> <a href="#val-root_of_compilation_unit"><span class="LIDENT">root_of_compilation_unit</span></a> <span class="TILDE">~</span><a href="#local_parent_spec_115"><span class="LIDENT">parent_spec</span></a> <span class="TILDE">~</span><a href="#local_hidden_108"><span class="LIDENT">hidden</span></a> <span class="TILDE">~</span><a href="#local_output_110"><span class="LIDENT">output</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_result_130"><span class="LIDENT">result</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">catch_errors_and_warnings</span> <span class="LPAREN">(</span><span class="FUN">fun</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>          <a href="#val-resolve_and_substitute"><span class="LIDENT">resolve_and_substitute</span></a> <span class="TILDE">~</span><a href="#local_resolver_106"><span class="LIDENT">resolver</span></a> <span class="TILDE">~</span><a href="#local_make_root_129"><span class="LIDENT">make_root</span></a> <span class="TILDE">~</span><a href="#local_hidden_108"><span class="LIDENT">hidden</span></a> <span class="TILDE">~</span><a href="#local_source_id_opt_124"><span class="LIDENT">source_id_opt</span></a><span class="EOL">
</span>            <span class="TILDE">~</span><a href="#local_cmt_filename_opt_113"><span class="LIDENT">cmt_filename_opt</span></a> <a href="#local_parent_126"><span class="LIDENT">parent</span></a> <a href="#local_input_114"><span class="LIDENT">input</span></a> <a href="#local_input_type_125"><span class="LIDENT">input_type</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="COMMENT">(* Extract warnings to write them into the output file *)</span><span class="EOL">
</span>    <span class="LET">let</span> <span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_warnings_131"><span class="LIDENT">warnings</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">unpack_warnings</span> <a href="#local_result_130"><span class="LIDENT">result</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="UIDENT">Error</span><span class="DOT">.</span><span class="LIDENT">handle_errors_and_warnings</span> <span class="TILDE">~</span><a href="#local_warnings_options_111"><span class="LIDENT">warnings_options</span></a> <a href="#local_result_130"><span class="LIDENT">result</span></a> <span class="INFIXOP0">&gt;&gt;=</span> <span class="FUN">fun</span> <span id="local_unit_132"><span class="LIDENT">unit</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">Odoc_file</span><span class="DOT">.</span><span class="LIDENT">save_unit</span> <a href="#local_output_110"><span class="LIDENT">output</span></a> <span class="TILDE">~</span><a href="#local_warnings_131"><span class="LIDENT">warnings</span></a> <a href="#local_unit_132"><span class="LIDENT">unit</span></a><span class="SEMI">;</span><span class="EOL">
</span>    <span class="UIDENT">Ok</span> <span class="LPAREN">(</span><span class="RPAREN">)</span><span class="EOL">
</span></span></code></pre></body></html>
