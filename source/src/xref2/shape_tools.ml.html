<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source: shape_tools.ml (odoc.source.src.xref2)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.css"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/></head><body class="odoc-src"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="../../../index.html">odoc</a> &#x00BB; <a href="../../index.html">source</a> &#x00BB; <a href="../index.html">src</a> &#x00BB; <a href="index.html">xref2</a> &#x00BB; shape_tools.ml</nav><header class="odoc-preamble"><h1>Source file <code><span>shape_tools.ml</span></code></h1></header><pre class="source_container"><code class="source_line_column"><a id="L1" class="source_line" href="#L1">1</a>
<a id="L2" class="source_line" href="#L2">2</a>
<a id="L3" class="source_line" href="#L3">3</a>
<a id="L4" class="source_line" href="#L4">4</a>
<a id="L5" class="source_line" href="#L5">5</a>
<a id="L6" class="source_line" href="#L6">6</a>
<a id="L7" class="source_line" href="#L7">7</a>
<a id="L8" class="source_line" href="#L8">8</a>
<a id="L9" class="source_line" href="#L9">9</a>
<a id="L10" class="source_line" href="#L10">10</a>
<a id="L11" class="source_line" href="#L11">11</a>
<a id="L12" class="source_line" href="#L12">12</a>
<a id="L13" class="source_line" href="#L13">13</a>
<a id="L14" class="source_line" href="#L14">14</a>
<a id="L15" class="source_line" href="#L15">15</a>
<a id="L16" class="source_line" href="#L16">16</a>
<a id="L17" class="source_line" href="#L17">17</a>
<a id="L18" class="source_line" href="#L18">18</a>
<a id="L19" class="source_line" href="#L19">19</a>
<a id="L20" class="source_line" href="#L20">20</a>
<a id="L21" class="source_line" href="#L21">21</a>
<a id="L22" class="source_line" href="#L22">22</a>
<a id="L23" class="source_line" href="#L23">23</a>
<a id="L24" class="source_line" href="#L24">24</a>
<a id="L25" class="source_line" href="#L25">25</a>
<a id="L26" class="source_line" href="#L26">26</a>
<a id="L27" class="source_line" href="#L27">27</a>
<a id="L28" class="source_line" href="#L28">28</a>
<a id="L29" class="source_line" href="#L29">29</a>
<a id="L30" class="source_line" href="#L30">30</a>
<a id="L31" class="source_line" href="#L31">31</a>
<a id="L32" class="source_line" href="#L32">32</a>
<a id="L33" class="source_line" href="#L33">33</a>
<a id="L34" class="source_line" href="#L34">34</a>
<a id="L35" class="source_line" href="#L35">35</a>
<a id="L36" class="source_line" href="#L36">36</a>
<a id="L37" class="source_line" href="#L37">37</a>
<a id="L38" class="source_line" href="#L38">38</a>
<a id="L39" class="source_line" href="#L39">39</a>
<a id="L40" class="source_line" href="#L40">40</a>
<a id="L41" class="source_line" href="#L41">41</a>
<a id="L42" class="source_line" href="#L42">42</a>
<a id="L43" class="source_line" href="#L43">43</a>
<a id="L44" class="source_line" href="#L44">44</a>
<a id="L45" class="source_line" href="#L45">45</a>
<a id="L46" class="source_line" href="#L46">46</a>
<a id="L47" class="source_line" href="#L47">47</a>
<a id="L48" class="source_line" href="#L48">48</a>
<a id="L49" class="source_line" href="#L49">49</a>
<a id="L50" class="source_line" href="#L50">50</a>
<a id="L51" class="source_line" href="#L51">51</a>
<a id="L52" class="source_line" href="#L52">52</a>
<a id="L53" class="source_line" href="#L53">53</a>
<a id="L54" class="source_line" href="#L54">54</a>
<a id="L55" class="source_line" href="#L55">55</a>
<a id="L56" class="source_line" href="#L56">56</a>
<a id="L57" class="source_line" href="#L57">57</a>
<a id="L58" class="source_line" href="#L58">58</a>
<a id="L59" class="source_line" href="#L59">59</a>
<a id="L60" class="source_line" href="#L60">60</a>
<a id="L61" class="source_line" href="#L61">61</a>
<a id="L62" class="source_line" href="#L62">62</a>
<a id="L63" class="source_line" href="#L63">63</a>
<a id="L64" class="source_line" href="#L64">64</a>
<a id="L65" class="source_line" href="#L65">65</a>
<a id="L66" class="source_line" href="#L66">66</a>
<a id="L67" class="source_line" href="#L67">67</a>
<a id="L68" class="source_line" href="#L68">68</a>
<a id="L69" class="source_line" href="#L69">69</a>
<a id="L70" class="source_line" href="#L70">70</a>
<a id="L71" class="source_line" href="#L71">71</a>
<a id="L72" class="source_line" href="#L72">72</a>
<a id="L73" class="source_line" href="#L73">73</a>
<a id="L74" class="source_line" href="#L74">74</a>
<a id="L75" class="source_line" href="#L75">75</a>
<a id="L76" class="source_line" href="#L76">76</a>
<a id="L77" class="source_line" href="#L77">77</a>
<a id="L78" class="source_line" href="#L78">78</a>
<a id="L79" class="source_line" href="#L79">79</a>
<a id="L80" class="source_line" href="#L80">80</a>
<a id="L81" class="source_line" href="#L81">81</a>
<a id="L82" class="source_line" href="#L82">82</a>
<a id="L83" class="source_line" href="#L83">83</a>
<a id="L84" class="source_line" href="#L84">84</a>
<a id="L85" class="source_line" href="#L85">85</a>
<a id="L86" class="source_line" href="#L86">86</a>
<a id="L87" class="source_line" href="#L87">87</a>
<a id="L88" class="source_line" href="#L88">88</a>
<a id="L89" class="source_line" href="#L89">89</a>
<a id="L90" class="source_line" href="#L90">90</a>
<a id="L91" class="source_line" href="#L91">91</a>
<a id="L92" class="source_line" href="#L92">92</a>
<a id="L93" class="source_line" href="#L93">93</a>
<a id="L94" class="source_line" href="#L94">94</a>
<a id="L95" class="source_line" href="#L95">95</a>
<a id="L96" class="source_line" href="#L96">96</a>
<a id="L97" class="source_line" href="#L97">97</a>
<a id="L98" class="source_line" href="#L98">98</a>
<a id="L99" class="source_line" href="#L99">99</a>
<a id="L100" class="source_line" href="#L100">100</a>
<a id="L101" class="source_line" href="#L101">101</a>
<a id="L102" class="source_line" href="#L102">102</a>
<a id="L103" class="source_line" href="#L103">103</a>
<a id="L104" class="source_line" href="#L104">104</a>
<a id="L105" class="source_line" href="#L105">105</a>
<a id="L106" class="source_line" href="#L106">106</a>
<a id="L107" class="source_line" href="#L107">107</a>
<a id="L108" class="source_line" href="#L108">108</a>
<a id="L109" class="source_line" href="#L109">109</a>
<a id="L110" class="source_line" href="#L110">110</a>
</code><code class="source_code"><span><span class="EOL">
</span># 3 &quot;shape_tools.cppo.ml&quot;<span class="EOL">
</span><span class="OPEN">open</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Paths</span><span class="EOL">
</span><span class="OPEN">open</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Names</span><span class="EOL">
</span><span id="module-Kind"><span class="MODULE">module</span> <span class="UIDENT">Kind</span> <span class="EQUAL">=</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="UIDENT">Sig_component_kind</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-(&gt;&gt;=)"><span class="LPAREN">(</span> <span class="INFIXOP0">&gt;&gt;=</span> <span class="RPAREN">)</span></span> <span id="local_m_1"><span class="LIDENT">m</span></span> <span id="local_f_2"><span class="LIDENT">f</span></span> <span class="EQUAL">=</span> <span class="MATCH">match</span> <a href="#local_m_1"><span class="LIDENT">m</span></a> <span class="WITH">with</span> <span class="UIDENT">Some</span> <span id="local_x_3"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_f_2"><span class="LIDENT">f</span></a> <a href="#local_x_3"><span class="LIDENT">x</span></a> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span id="type-t"><span class="TYPE">type</span> <span class="LIDENT">t</span> <span class="EQUAL">=</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="STAR">*</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Paths</span><span class="DOT">.</span><span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">SourceLocation</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="UIDENT">Uid</span><span class="DOT">.</span><span class="UIDENT">Map</span><span class="DOT">.</span><span class="LIDENT">t</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="DOCSTRING">(** Project an identifier into a shape. *)</span><span class="EOL">
</span><span class="LET">let</span> <span class="REC">rec</span> <span id="val-shape_of_id"><span class="LIDENT">shape_of_id</span></span> <span id="local_env_4"><span class="LIDENT">env</span></span> <span class="COLON">:</span><span class="EOL">
</span>    <span class="LBRACKETLESS">[&lt;</span> <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">NonSrc</span><span class="DOT">.</span><span class="LIDENT">t_pv</span> <span class="RBRACKET">]</span> <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="LIDENT">id</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_proj_5"><span class="LIDENT">proj</span></span> <span id="local_parent_6"><span class="LIDENT">parent</span></span> <span id="local_kind_7"><span class="LIDENT">kind</span></span> <span id="local_name_8"><span class="LIDENT">name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_item_9"><span class="LIDENT">item</span></span> <span class="EQUAL">=</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="UIDENT">Item</span><span class="DOT">.</span><span class="LIDENT">make</span> <a href="#local_name_8"><span class="LIDENT">name</span></a> <a href="#local_kind_7"><span class="LIDENT">kind</span></a> <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#val-shape_of_id"><span class="LIDENT">shape_of_id</span></a> <a href="#local_env_4"><span class="LIDENT">env</span></a> <span class="LPAREN">(</span><a href="#local_parent_6"><span class="LIDENT">parent</span></a> <span class="COLONGREATER">:&gt;</span> <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">NonSrc</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_shape_10"><span class="LIDENT">shape</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Shape</span><span class="DOT">.</span><span class="LIDENT">proj</span> <a href="#local_shape_10"><span class="LIDENT">shape</span></a> <a href="#local_item_9"><span class="LIDENT">item</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="IN">in</span><span class="EOL">
</span>  <span class="FUN">fun</span> <span id="local_id_11"><span class="LIDENT">id</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="MATCH">match</span> <a href="#local_id_11"><span class="LIDENT">id</span></a><span class="DOT">.</span><span class="LIDENT">iv</span> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Root</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_name_12"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="BEGIN">begin</span><span class="EOL">
</span>        <span class="MATCH">match</span> <span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">lookup_unit</span> <span class="LPAREN">(</span><span class="UIDENT">ModuleName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_12"><span class="LIDENT">name</span></a><span class="RPAREN">)</span> <a href="#local_env_4"><span class="LIDENT">env</span></a> <span class="WITH">with</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Env</span><span class="DOT">.</span><span class="UIDENT">Found</span> <span id="local_unit_13"><span class="LIDENT">unit</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>          <span class="MATCH">match</span> <a href="#local_unit_13"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="LIDENT">shape_info</span> <span class="WITH">with</span> <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_shape_14"><span class="LIDENT">shape</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_shape_14"><span class="LIDENT">shape</span></a> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span>        <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>      <span class="END">end</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Module</span> <span class="LPAREN">(</span><span id="local_parent_15"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_16"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_15"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Module</span> <span class="LPAREN">(</span><span class="UIDENT">ModuleName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_16"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Result</span> <span id="local_parent_17"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="COMMENT">(* Apply the functor to an empty signature. This doesn't seem to cause
           any problem, as the shape would stop resolve on an item inside the
           result of the function, which is what we want. *)</span><span class="EOL">
</span>        <a href="#val-shape_of_id"><span class="LIDENT">shape_of_id</span></a> <a href="#local_env_4"><span class="LIDENT">env</span></a> <span class="LPAREN">(</span><a href="#local_parent_17"><span class="LIDENT">parent</span></a> <span class="COLONGREATER">:&gt;</span> <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">NonSrc</span><span class="DOT">.</span><span class="LIDENT">t</span><span class="RPAREN">)</span><span class="EOL">
</span>        <a href="#val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_parent_18"><span class="LIDENT">parent</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Shape</span><span class="DOT">.</span><span class="LIDENT">app</span> <a href="#local_parent_18"><span class="LIDENT">parent</span></a> <span class="LABEL">~arg:</span><span class="LPAREN">(</span><span class="UIDENT">Shape</span><span class="DOT">.</span><span class="LIDENT">str</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="UIDENT">Item</span><span class="DOT">.</span><span class="UIDENT">Map</span><span class="DOT">.</span><span class="LIDENT">empty</span><span class="RPAREN">)</span><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">ModuleType</span> <span class="LPAREN">(</span><span id="local_parent_19"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_20"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_19"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Module_type</span> <span class="LPAREN">(</span><span class="UIDENT">ModuleTypeName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_20"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Type</span> <span class="LPAREN">(</span><span id="local_parent_21"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_22"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_21"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Type</span> <span class="LPAREN">(</span><span class="UIDENT">TypeName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_22"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Value</span> <span class="LPAREN">(</span><span id="local_parent_23"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_24"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_23"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Value</span> <span class="LPAREN">(</span><span class="UIDENT">ValueName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_24"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Extension</span> <span class="LPAREN">(</span><span id="local_parent_25"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_26"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_25"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Extension_constructor</span> <span class="LPAREN">(</span><span class="UIDENT">ExtensionName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_26"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">ExtensionDecl</span> <span class="LPAREN">(</span><span id="local_parent_27"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_28"><span class="LIDENT">name</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_27"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Extension_constructor</span> <span class="LPAREN">(</span><span class="UIDENT">ExtensionName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_28"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Exception</span> <span class="LPAREN">(</span><span id="local_parent_29"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_30"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_29"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Extension_constructor</span> <span class="LPAREN">(</span><span class="UIDENT">ExceptionName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_30"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Class</span> <span class="LPAREN">(</span><span id="local_parent_31"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_32"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_31"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Class</span> <span class="LPAREN">(</span><span class="UIDENT">ClassName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_32"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">ClassType</span> <span class="LPAREN">(</span><span id="local_parent_33"><span class="LIDENT">parent</span></span><span class="COMMA">,</span> <span id="local_name_34"><span class="LIDENT">name</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <a href="#local_proj_5"><span class="LIDENT">proj</span></a> <a href="#local_parent_33"><span class="LIDENT">parent</span></a> <span class="UIDENT">Kind</span><span class="DOT">.</span><span class="UIDENT">Class_type</span> <span class="LPAREN">(</span><span class="UIDENT">ClassTypeName</span><span class="DOT">.</span><span class="LIDENT">to_string</span> <a href="#local_name_34"><span class="LIDENT">name</span></a><span class="RPAREN">)</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Page</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">LeafPage</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Label</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">CoreType</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">CoreException</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Constructor</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Field</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Method</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">InstanceVariable</span> <span class="UNDERSCORE">_</span> <span class="BAR">|</span> <span class="BACKQUOTE">`</span><span class="UIDENT">Parameter</span> <span class="UNDERSCORE">_</span><span class="EOL">
</span>      <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>        <span class="COMMENT">(* Not represented in shapes. *)</span><span class="EOL">
</span>        <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span id="module-MkId"><span class="MODULE">module</span> <span class="UIDENT">MkId</span> <span class="EQUAL">=</span> <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">Mk</span></span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-unit_of_uid"><span class="LIDENT">unit_of_uid</span></span> <span id="local_uid_35"><span class="LIDENT">uid</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#local_uid_35"><span class="LIDENT">uid</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="UIDENT">Uid</span><span class="DOT">.</span><span class="UIDENT">Compilation_unit</span> <span id="local_s_36"><span class="LIDENT">s</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_s_36"><span class="LIDENT">s</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Item</span> <span class="LBRACE">{</span> <span id="local_comp_unit_37"><span class="LIDENT">comp_unit</span></span><span class="SEMI">;</span> <span class="LIDENT">id</span> <span class="EQUAL">=</span> <span class="UNDERSCORE">_</span> <span class="RBRACE">}</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_comp_unit_37"><span class="LIDENT">comp_unit</span></a><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Predef</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Internal</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_shape"><span class="LIDENT">lookup_shape</span></span> <span class="COLON">:</span><span class="EOL">
</span>    <span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">SourceLocation</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span> <span class="EQUAL">=</span><span class="EOL">
</span> <span class="FUN">fun</span> <span id="local_env_38"><span class="LIDENT">env</span></span> <span id="local_query_39"><span class="LIDENT">query</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="LET">let</span> <span class="MODULE">module</span> <span class="UIDENT">Reduce</span> <span class="EQUAL">=</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="UIDENT">Make_reduce</span> <span class="LPAREN">(</span><span class="STRUCT">struct</span><span class="EOL">
</span>    <span id="def_58"><span class="TYPE">type</span> <span class="LIDENT">env</span> <span class="EQUAL">=</span> <span class="LIDENT">unit</span></span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_fuel_40"><span class="LIDENT">fuel</span></span> <span class="EQUAL">=</span> <span class="INT">10</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_read_unit_shape_41"><span class="LIDENT">read_unit_shape</span></span> <span class="TILDE">~</span><span id="local_unit_name_42"><span class="LIDENT">unit_name</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">lookup_unit</span> <a href="#local_unit_name_42"><span class="LIDENT">unit_name</span></a> <a href="#local_env_38"><span class="LIDENT">env</span></a> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Found</span> <span id="local_unit_43"><span class="LIDENT">unit</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>        <span class="MATCH">match</span> <a href="#local_unit_43"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="LIDENT">shape_info</span> <span class="WITH">with</span> <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span id="local_shape_44"><span class="LIDENT">shape</span></span><span class="COMMA">,</span> <span class="UNDERSCORE">_</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_shape_44"><span class="LIDENT">shape</span></a> <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UNDERSCORE">_</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>    <span class="LET">let</span> <span id="local_find_shape_45"><span class="LIDENT">find_shape</span></span> <span class="UNDERSCORE">_</span> <span class="UNDERSCORE">_</span> <span class="EQUAL">=</span> <span class="LIDENT">raise</span> <span class="UIDENT">Not_found</span><span class="EOL">
</span>  <span class="END">end</span><span class="RPAREN">)</span> <span class="IN">in</span><span class="EOL">
</span>  <span class="LET">let</span> <span id="local_result_46"><span class="LIDENT">result</span></span> <span class="EQUAL">=</span> <span class="TRY">try</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Reduce</span><span class="DOT">.</span><span class="LIDENT">reduce</span> <span class="LPAREN">(</span><span class="RPAREN">)</span> <a href="#local_query_39"><span class="LIDENT">query</span></a><span class="RPAREN">)</span> <span class="WITH">with</span> <span class="UIDENT">Not_found</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span> <span class="IN">in</span><span class="EOL">
</span>  <a href="#local_result_46"><span class="LIDENT">result</span></a> <a href="#val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_result_47"><span class="LIDENT">result</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <a href="#local_result_47"><span class="LIDENT">result</span></a><span class="DOT">.</span><span class="LIDENT">uid</span> <a href="#val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_uid_48"><span class="LIDENT">uid</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <a href="#val-unit_of_uid"><span class="LIDENT">unit_of_uid</span></a> <a href="#local_uid_48"><span class="LIDENT">uid</span></a> <a href="#val-(&gt;&gt;=)"><span class="INFIXOP0">&gt;&gt;=</span></a> <span class="FUN">fun</span> <span id="local_unit_name_49"><span class="LIDENT">unit_name</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="MATCH">match</span> <span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">lookup_unit</span> <a href="#local_unit_name_49"><span class="LIDENT">unit_name</span></a> <a href="#local_env_38"><span class="LIDENT">env</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="UIDENT">Forward_reference</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Not_found</span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">Found</span> <span id="local_unit_50"><span class="LIDENT">unit</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <span class="EOL">
</span>    <span class="LET">let</span> <span id="local_uid_to_id_51"><span class="LIDENT">uid_to_id</span></span> <span class="EQUAL">=</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_unit_50"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="LIDENT">shape_info</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UNDERSCORE">_</span><span class="COMMA">,</span> <span id="local_uid_to_id_52"><span class="LIDENT">uid_to_id</span></span><span class="RPAREN">)</span> <span class="MINUSGREATER">-&gt;</span> <a href="#local_uid_to_id_52"><span class="LIDENT">uid_to_id</span></a><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Odoc_model</span><span class="DOT">.</span><span class="UIDENT">Compat</span><span class="DOT">.</span><span class="LIDENT">empty_map</span><span class="EOL">
</span>    <span class="IN">in</span><span class="EOL">
</span>    <span class="MATCH">match</span> <span class="UIDENT">Shape</span><span class="DOT">.</span><span class="UIDENT">Uid</span><span class="DOT">.</span><span class="UIDENT">Map</span><span class="DOT">.</span><span class="LIDENT">find_opt</span> <a href="#local_uid_48"><span class="LIDENT">uid</span></a> <a href="#local_uid_to_id_51"><span class="LIDENT">uid_to_id</span></a> <span class="WITH">with</span><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_x_53"><span class="LIDENT">x</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <a href="#local_x_53"><span class="LIDENT">x</span></a><span class="EOL">
</span>    <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="LPAREN">(</span><span class="EOL">
</span>      <span class="MATCH">match</span> <a href="#local_unit_50"><span class="LIDENT">unit</span></a><span class="DOT">.</span><span class="LIDENT">source_info</span> <span class="WITH">with</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_si_54"><span class="LIDENT">si</span></span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">Some</span> <span class="LPAREN">(</span><span class="UIDENT">MkId</span><span class="DOT">.</span><span class="LIDENT">source_location_mod</span> <a href="#local_si_54"><span class="LIDENT">si</span></a><span class="DOT">.</span><span class="LIDENT">id</span><span class="RPAREN">)</span><span class="EOL">
</span>      <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="RPAREN">)</span><span class="EOL">
</span><span class="EOL">
</span><span class="EOL">
</span><span class="LET">let</span> <span id="val-lookup_def"><span class="LIDENT">lookup_def</span></span> <span class="COLON">:</span><span class="EOL">
</span>    <span class="UIDENT">Env</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">NonSrc</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>    <span class="UIDENT">Identifier</span><span class="DOT">.</span><span class="UIDENT">SourceLocation</span><span class="DOT">.</span><span class="LIDENT">t</span> <span class="LIDENT">option</span> <span class="EQUAL">=</span><span class="EOL">
</span> <span class="FUN">fun</span> <span id="local_env_55"><span class="LIDENT">env</span></span> <span id="local_id_56"><span class="LIDENT">id</span></span> <span class="MINUSGREATER">-&gt;</span><span class="EOL">
</span>  <span class="MATCH">match</span> <a href="#val-shape_of_id"><span class="LIDENT">shape_of_id</span></a> <a href="#local_env_55"><span class="LIDENT">env</span></a> <a href="#local_id_56"><span class="LIDENT">id</span></a> <span class="WITH">with</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">None</span> <span class="MINUSGREATER">-&gt;</span> <span class="UIDENT">None</span><span class="EOL">
</span>  <span class="BAR">|</span> <span class="UIDENT">Some</span> <span id="local_query_57"><span class="LIDENT">query</span></span> <span class="MINUSGREATER">-&gt;</span> <a href="#val-lookup_shape"><span class="LIDENT">lookup_shape</span></a> <a href="#local_env_55"><span class="LIDENT">env</span></a> <a href="#local_query_57"><span class="LIDENT">query</span></a><span class="EOL">
</span><span class="EOL">
</span></span></code></pre></body></html>
